from MarketSimulator import MarketSimulator
from CTXPyClient import CTXPyClient
import numpy as np
from time import sleep

def ParseState(spread, imbalance):
    if (spread > 1): #Large spread
        if (np.abs(imbalance) > 2): #Imbalanced
            return 2 #'Large-Imbalanced'
        else:
            return 3 #'Large-Balanced'
    else: #Tight spread
        if (np.abs(imbalance) > 2): #Imbalanced
            return 0 #'Tight-Imbalanced'
        else:
            return 1 #'Tight-Balanced'

if __name__ == "__main__":

    MarketOrderAskStr      = 'MarketOrder_Ask'
    MarketOrderBidStr      = 'MarketOrder_Bid'
    AggressiveLimitBidStr  = 'AgressiveLimit_Bid'
    AggressiveLimitAskStr  = 'AgressiveLimit_Ask'
    PassiveLimitBidStr     = 'PassiveLimit_Bid'
    PassiveLimitAskStr     = 'PassiveLimit_Ask'
    AggressiveCancelBidStr = 'AggressiveCancel_Bid'
    AggressiveCancelAskStr = 'AggressiveCancel_Ask'
    PassiveCancelBidStr    = 'PassiveCancel_Bid'
    PassiveCancelAskStr    = 'PassiveCancel_Ask'

    n_events      = 10  # number of event types, $d_e$
    n_states      = 4  # number of possible states, $d_x$
    events_labels = ['MarketOrder_Ask', 'MarketOrder_Bid', 'AgressiveLimit_Bid', 'AgressiveLimit_Ask', 'PassiveLimit_Bid', 'PassiveLimit_Ask', 'AggressiveCancel_Bid', 'AggressiveCancel_Ask', 'PassiveCancel_Bid', 'PassiveCancel_Ask']  # names of the event types
    states_labels = ['Tight-Imbalanced', 'Tight-Balanced', 'Large-Imbalanced', 'Large-Balanced']  # names of the states

    # The transition probabilities $\phi$
    phis = np.zeros((n_states, n_events, n_states))
    # phis[0, 0, 0] = 0.7   
    # phis[0, 0, 1] = 0.3
    # phis[1, 0, 0] = 0.6
    # phis[1, 0, 1] = 0.4  # $\phi_0(1, 1)$, probability of transitioning from state 1 to 1 when an event of type 0 occurs
    # phis[0, 1, 0] = 0.2
    # phis[0, 1, 1] = 0.8
    # phis[1, 1, 0] = 0.4
    # phis[1, 1, 1] = 0.6
    phis[0,0,0] = 0.025
    phis[0,0,1] = 0.025
    phis[0,0,2] = 0.025
    phis[0,0,3] = 0.025
    phis[0,1,0] = 0.025
    phis[0,1,1] = 0.025
    phis[0,1,2] = 0.025
    phis[0,1,3] = 0.025
    phis[0,2,0] = 0.025
    phis[0,2,1] = 0.025
    phis[0,2,2] = 0.025
    phis[0,2,3] = 0.025
    phis[0,3,0] = 0.025
    phis[0,3,1] = 0.025
    phis[0,3,2] = 0.025
    phis[0,3,3] = 0.025
    phis[0,4,0] = 0.025
    phis[0,4,1] = 0.025
    phis[0,4,2] = 0.025
    phis[0,4,3] = 0.025
    phis[0,5,0] = 0.025
    phis[0,5,1] = 0.025
    phis[0,5,2] = 0.025
    phis[0,5,3] = 0.025
    phis[0,6,0] = 0.025
    phis[0,6,1] = 0.025
    phis[0,6,2] = 0.025
    phis[0,6,3] = 0.025
    phis[0,7,0] = 0.025
    phis[0,7,1] = 0.025
    phis[0,7,2] = 0.025
    phis[0,7,3] = 0.025
    phis[0,8,0] = 0.025
    phis[0,8,1] = 0.025
    phis[0,8,2] = 0.025
    phis[0,8,3] = 0.025
    phis[0,9,0] = 0.025
    phis[0,9,1] = 0.025
    phis[0,9,2] = 0.025
    phis[0,9,3] = 0.025
    phis[1,0,0] = 0.025
    phis[1,0,1] = 0.025
    phis[1,0,2] = 0.025
    phis[1,0,3] = 0.025
    phis[1,1,0] = 0.025
    phis[1,1,1] = 0.025
    phis[1,1,2] = 0.025
    phis[1,1,3] = 0.025
    phis[1,2,0] = 0.025
    phis[1,2,1] = 0.025
    phis[1,2,2] = 0.025
    phis[1,2,3] = 0.025
    phis[1,3,0] = 0.025
    phis[1,3,1] = 0.025
    phis[1,3,2] = 0.025
    phis[1,3,3] = 0.025
    phis[1,4,0] = 0.025
    phis[1,4,1] = 0.025
    phis[1,4,2] = 0.025
    phis[1,4,3] = 0.025
    phis[1,5,0] = 0.025
    phis[1,5,1] = 0.025
    phis[1,5,2] = 0.025
    phis[1,5,3] = 0.025
    phis[1,6,0] = 0.025
    phis[1,6,1] = 0.025
    phis[1,6,2] = 0.025
    phis[1,6,3] = 0.025
    phis[1,7,0] = 0.025
    phis[1,7,1] = 0.025
    phis[1,7,2] = 0.025
    phis[1,7,3] = 0.025
    phis[1,8,0] = 0.025
    phis[1,8,1] = 0.025
    phis[1,8,2] = 0.025
    phis[1,8,3] = 0.025
    phis[1,9,0] = 0.025
    phis[1,9,1] = 0.025
    phis[1,9,2] = 0.025
    phis[1,9,3] = 0.025
    phis[2,0,0] = 0.025
    phis[2,0,1] = 0.025
    phis[2,0,2] = 0.025
    phis[2,0,3] = 0.025
    phis[2,1,0] = 0.025
    phis[2,1,1] = 0.025
    phis[2,1,2] = 0.025
    phis[2,1,3] = 0.025
    phis[2,2,0] = 0.025
    phis[2,2,1] = 0.025
    phis[2,2,2] = 0.025
    phis[2,2,3] = 0.025
    phis[2,3,0] = 0.025
    phis[2,3,1] = 0.025
    phis[2,3,2] = 0.025
    phis[2,3,3] = 0.025
    phis[2,4,0] = 0.025
    phis[2,4,1] = 0.025
    phis[2,4,2] = 0.025
    phis[2,4,3] = 0.025
    phis[2,5,0] = 0.025
    phis[2,5,1] = 0.025
    phis[2,5,2] = 0.025
    phis[2,5,3] = 0.025
    phis[2,6,0] = 0.025
    phis[2,6,1] = 0.025
    phis[2,6,2] = 0.025
    phis[2,6,3] = 0.025
    phis[2,7,0] = 0.025
    phis[2,7,1] = 0.025
    phis[2,7,2] = 0.025
    phis[2,7,3] = 0.025
    phis[2,8,0] = 0.025
    phis[2,8,1] = 0.025
    phis[2,8,2] = 0.025
    phis[2,8,3] = 0.025
    phis[2,9,0] = 0.025
    phis[2,9,1] = 0.025
    phis[2,9,2] = 0.025
    phis[2,9,3] = 0.025
    phis[3,0,0] = 0.025
    phis[3,0,1] = 0.025
    phis[3,0,2] = 0.025
    phis[3,0,3] = 0.025
    phis[3,1,0] = 0.025
    phis[3,1,1] = 0.025
    phis[3,1,2] = 0.025
    phis[3,1,3] = 0.025
    phis[3,2,0] = 0.025
    phis[3,2,1] = 0.025
    phis[3,2,2] = 0.025
    phis[3,2,3] = 0.025
    phis[3,3,0] = 0.025
    phis[3,3,1] = 0.025
    phis[3,3,2] = 0.025
    phis[3,3,3] = 0.025
    phis[3,4,0] = 0.025
    phis[3,4,1] = 0.025
    phis[3,4,2] = 0.025
    phis[3,4,3] = 0.025
    phis[3,5,0] = 0.025
    phis[3,5,1] = 0.025
    phis[3,5,2] = 0.025
    phis[3,5,3] = 0.025
    phis[3,6,0] = 0.025
    phis[3,6,1] = 0.025
    phis[3,6,2] = 0.025
    phis[3,6,3] = 0.025
    phis[3,7,0] = 0.025
    phis[3,7,1] = 0.025
    phis[3,7,2] = 0.025
    phis[3,7,3] = 0.025
    phis[3,8,0] = 0.025
    phis[3,8,1] = 0.025
    phis[3,8,2] = 0.025
    phis[3,8,3] = 0.025
    phis[3,9,0] = 0.025
    phis[3,9,1] = 0.025
    phis[3,9,2] = 0.025
    phis[3,9,3] = 0.025

    # The base rates $\nu$
    nus = np.ones(n_events)

    # The impact coefficients $\alpha$
    alphas = np.zeros((n_events, n_states, n_events))
    # alphas[0, 0, 0] = 0.2
    # alphas[0, 0, 1] = 0.1
    # alphas[1, 0, 0] = 0.1
    # alphas[1, 0, 1] = 0.4
    # alphas[0, 1, 0] = 0.2
    # alphas[0, 1, 1] = 0.10
    # alphas[1, 1, 0] = 0.5
    # alphas[1, 1, 1] = 0.1

    alphas[0,0,0] = 0
    alphas[0,0,1] = 5
    alphas[0,0,2] = 5
    alphas[0,0,3] = 1
    alphas[0,0,4] = 5
    alphas[0,0,5] = 0
    alphas[0,0,6] = 5
    alphas[0,0,7] = 5
    alphas[0,0,8] = 0
    alphas[0,0,9] = 0
    alphas[0,1,0] = 2
    alphas[0,1,1] = 0
    alphas[0,1,2] = 1
    alphas[0,1,3] = 0
    alphas[0,1,4] = 5
    alphas[0,1,5] = 1
    alphas[0,1,6] = 5
    alphas[0,1,7] = 5
    alphas[0,1,8] = 0
    alphas[0,1,9] = 5
    alphas[0,2,0] = 0
    alphas[0,2,1] = 2
    alphas[0,2,2] = 4
    alphas[0,2,3] = 3
    alphas[0,2,4] = 0
    alphas[0,2,5] = 1
    alphas[0,2,6] = 4
    alphas[0,2,7] = 2
    alphas[0,2,8] = 0
    alphas[0,2,9] = 3
    alphas[0,3,0] = 5
    alphas[0,3,1] = 0
    alphas[0,3,2] = 2
    alphas[0,3,3] = 1
    alphas[0,3,4] = 1
    alphas[0,3,5] = 2
    alphas[0,3,6] = 1
    alphas[0,3,7] = 1
    alphas[0,3,8] = 0
    alphas[0,3,9] = 0
    alphas[1,0,0] = 1
    alphas[1,0,1] = 0
    alphas[1,0,2] = 4
    alphas[1,0,3] = 5
    alphas[1,0,4] = 5
    alphas[1,0,5] = 0
    alphas[1,0,6] = 1
    alphas[1,0,7] = 4
    alphas[1,0,8] = 2
    alphas[1,0,9] = 2
    alphas[1,1,0] = 0
    alphas[1,1,1] = 1
    alphas[1,1,2] = 2
    alphas[1,1,3] = 5
    alphas[1,1,4] = 3
    alphas[1,1,5] = 3
    alphas[1,1,6] = 2
    alphas[1,1,7] = 3
    alphas[1,1,8] = 5
    alphas[1,1,9] = 5
    alphas[1,2,0] = 0
    alphas[1,2,1] = 4
    alphas[1,2,2] = 3
    alphas[1,2,3] = 4
    alphas[1,2,4] = 1
    alphas[1,2,5] = 5
    alphas[1,2,6] = 2
    alphas[1,2,7] = 4
    alphas[1,2,8] = 1
    alphas[1,2,9] = 2
    alphas[1,3,0] = 5
    alphas[1,3,1] = 4
    alphas[1,3,2] = 2
    alphas[1,3,3] = 5
    alphas[1,3,4] = 2
    alphas[1,3,5] = 1
    alphas[1,3,6] = 0
    alphas[1,3,7] = 3
    alphas[1,3,8] = 5
    alphas[1,3,9] = 1
    alphas[2,0,0] = 3
    alphas[2,0,1] = 1
    alphas[2,0,2] = 2
    alphas[2,0,3] = 1
    alphas[2,0,4] = 2
    alphas[2,0,5] = 0
    alphas[2,0,6] = 4
    alphas[2,0,7] = 2
    alphas[2,0,8] = 1
    alphas[2,0,9] = 2
    alphas[2,1,0] = 1
    alphas[2,1,1] = 5
    alphas[2,1,2] = 1
    alphas[2,1,3] = 5
    alphas[2,1,4] = 4
    alphas[2,1,5] = 0
    alphas[2,1,6] = 3
    alphas[2,1,7] = 4
    alphas[2,1,8] = 5
    alphas[2,1,9] = 2
    alphas[2,2,0] = 4
    alphas[2,2,1] = 3
    alphas[2,2,2] = 0
    alphas[2,2,3] = 5
    alphas[2,2,4] = 4
    alphas[2,2,5] = 2
    alphas[2,2,6] = 1
    alphas[2,2,7] = 0
    alphas[2,2,8] = 5
    alphas[2,2,9] = 1
    alphas[2,3,0] = 2
    alphas[2,3,1] = 5
    alphas[2,3,2] = 0
    alphas[2,3,3] = 3
    alphas[2,3,4] = 5
    alphas[2,3,5] = 0
    alphas[2,3,6] = 5
    alphas[2,3,7] = 1
    alphas[2,3,8] = 2
    alphas[2,3,9] = 5
    alphas[3,0,0] = 2
    alphas[3,0,1] = 1
    alphas[3,0,2] = 0
    alphas[3,0,3] = 1
    alphas[3,0,4] = 0
    alphas[3,0,5] = 2
    alphas[3,0,6] = 4
    alphas[3,0,7] = 1
    alphas[3,0,8] = 2
    alphas[3,0,9] = 5
    alphas[3,1,0] = 3
    alphas[3,1,1] = 2
    alphas[3,1,2] = 5
    alphas[3,1,3] = 2
    alphas[3,1,4] = 3
    alphas[3,1,5] = 4
    alphas[3,1,6] = 4
    alphas[3,1,7] = 3
    alphas[3,1,8] = 4
    alphas[3,1,9] = 1
    alphas[3,2,0] = 1
    alphas[3,2,1] = 3
    alphas[3,2,2] = 0
    alphas[3,2,3] = 3
    alphas[3,2,4] = 3
    alphas[3,2,5] = 5
    alphas[3,2,6] = 2
    alphas[3,2,7] = 2
    alphas[3,2,8] = 2
    alphas[3,2,9] = 4
    alphas[3,3,0] = 2
    alphas[3,3,1] = 2
    alphas[3,3,2] = 1
    alphas[3,3,3] = 1
    alphas[3,3,4] = 2
    alphas[3,3,5] = 1
    alphas[3,3,6] = 4
    alphas[3,3,7] = 0
    alphas[3,3,8] = 0
    alphas[3,3,9] = 0
    alphas[4,0,0] = 1
    alphas[4,0,1] = 5
    alphas[4,0,2] = 2
    alphas[4,0,3] = 2
    alphas[4,0,4] = 2
    alphas[4,0,5] = 2
    alphas[4,0,6] = 2
    alphas[4,0,7] = 0
    alphas[4,0,8] = 2
    alphas[4,0,9] = 5
    alphas[4,1,0] = 4
    alphas[4,1,1] = 5
    alphas[4,1,2] = 1
    alphas[4,1,3] = 3
    alphas[4,1,4] = 1
    alphas[4,1,5] = 3
    alphas[4,1,6] = 2
    alphas[4,1,7] = 2
    alphas[4,1,8] = 2
    alphas[4,1,9] = 4
    alphas[4,2,0] = 0
    alphas[4,2,1] = 3
    alphas[4,2,2] = 3
    alphas[4,2,3] = 4
    alphas[4,2,4] = 0
    alphas[4,2,5] = 2
    alphas[4,2,6] = 5
    alphas[4,2,7] = 0
    alphas[4,2,8] = 4
    alphas[4,2,9] = 0
    alphas[4,3,0] = 3
    alphas[4,3,1] = 4
    alphas[4,3,2] = 1
    alphas[4,3,3] = 2
    alphas[4,3,4] = 0
    alphas[4,3,5] = 2
    alphas[4,3,6] = 5
    alphas[4,3,7] = 5
    alphas[4,3,8] = 5
    alphas[4,3,9] = 5
    alphas[5,0,0] = 5
    alphas[5,0,1] = 0
    alphas[5,0,2] = 3
    alphas[5,0,3] = 4
    alphas[5,0,4] = 5
    alphas[5,0,5] = 3
    alphas[5,0,6] = 3
    alphas[5,0,7] = 4
    alphas[5,0,8] = 0
    alphas[5,0,9] = 5
    alphas[5,1,0] = 0
    alphas[5,1,1] = 2
    alphas[5,1,2] = 1
    alphas[5,1,3] = 0
    alphas[5,1,4] = 5
    alphas[5,1,5] = 0
    alphas[5,1,6] = 2
    alphas[5,1,7] = 1
    alphas[5,1,8] = 4
    alphas[5,1,9] = 4
    alphas[5,2,0] = 5
    alphas[5,2,1] = 2
    alphas[5,2,2] = 4
    alphas[5,2,3] = 0
    alphas[5,2,4] = 2
    alphas[5,2,5] = 4
    alphas[5,2,6] = 5
    alphas[5,2,7] = 5
    alphas[5,2,8] = 3
    alphas[5,2,9] = 2
    alphas[5,3,0] = 0
    alphas[5,3,1] = 3
    alphas[5,3,2] = 5
    alphas[5,3,3] = 4
    alphas[5,3,4] = 3
    alphas[5,3,5] = 5
    alphas[5,3,6] = 4
    alphas[5,3,7] = 1
    alphas[5,3,8] = 2
    alphas[5,3,9] = 2
    alphas[6,0,0] = 4
    alphas[6,0,1] = 5
    alphas[6,0,2] = 3
    alphas[6,0,3] = 2
    alphas[6,0,4] = 3
    alphas[6,0,5] = 5
    alphas[6,0,6] = 3
    alphas[6,0,7] = 2
    alphas[6,0,8] = 5
    alphas[6,0,9] = 4
    alphas[6,1,0] = 0
    alphas[6,1,1] = 0
    alphas[6,1,2] = 2
    alphas[6,1,3] = 0
    alphas[6,1,4] = 4
    alphas[6,1,5] = 0
    alphas[6,1,6] = 1
    alphas[6,1,7] = 0
    alphas[6,1,8] = 3
    alphas[6,1,9] = 0
    alphas[6,2,0] = 4
    alphas[6,2,1] = 3
    alphas[6,2,2] = 2
    alphas[6,2,3] = 5
    alphas[6,2,4] = 0
    alphas[6,2,5] = 1
    alphas[6,2,6] = 0
    alphas[6,2,7] = 0
    alphas[6,2,8] = 0
    alphas[6,2,9] = 5
    alphas[6,3,0] = 0
    alphas[6,3,1] = 3
    alphas[6,3,2] = 5
    alphas[6,3,3] = 1
    alphas[6,3,4] = 2
    alphas[6,3,5] = 2
    alphas[6,3,6] = 5
    alphas[6,3,7] = 5
    alphas[6,3,8] = 2
    alphas[6,3,9] = 2
    alphas[7,0,0] = 4
    alphas[7,0,1] = 1
    alphas[7,0,2] = 1
    alphas[7,0,3] = 2
    alphas[7,0,4] = 4
    alphas[7,0,5] = 3
    alphas[7,0,6] = 0
    alphas[7,0,7] = 2
    alphas[7,0,8] = 0
    alphas[7,0,9] = 5
    alphas[7,1,0] = 5
    alphas[7,1,1] = 4
    alphas[7,1,2] = 1
    alphas[7,1,3] = 3
    alphas[7,1,4] = 1
    alphas[7,1,5] = 5
    alphas[7,1,6] = 3
    alphas[7,1,7] = 2
    alphas[7,1,8] = 0
    alphas[7,1,9] = 1
    alphas[7,2,0] = 0
    alphas[7,2,1] = 2
    alphas[7,2,2] = 0
    alphas[7,2,3] = 1
    alphas[7,2,4] = 5
    alphas[7,2,5] = 5
    alphas[7,2,6] = 3
    alphas[7,2,7] = 2
    alphas[7,2,8] = 1
    alphas[7,2,9] = 4
    alphas[7,3,0] = 4
    alphas[7,3,1] = 0
    alphas[7,3,2] = 2
    alphas[7,3,3] = 4
    alphas[7,3,4] = 5
    alphas[7,3,5] = 5
    alphas[7,3,6] = 5
    alphas[7,3,7] = 4
    alphas[7,3,8] = 3
    alphas[7,3,9] = 1
    alphas[8,0,0] = 4
    alphas[8,0,1] = 1
    alphas[8,0,2] = 5
    alphas[8,0,3] = 0
    alphas[8,0,4] = 5
    alphas[8,0,5] = 5
    alphas[8,0,6] = 4
    alphas[8,0,7] = 1
    alphas[8,0,8] = 5
    alphas[8,0,9] = 4
    alphas[8,1,0] = 2
    alphas[8,1,1] = 0
    alphas[8,1,2] = 5
    alphas[8,1,3] = 3
    alphas[8,1,4] = 2
    alphas[8,1,5] = 1
    alphas[8,1,6] = 1
    alphas[8,1,7] = 3
    alphas[8,1,8] = 1
    alphas[8,1,9] = 4
    alphas[8,2,0] = 0
    alphas[8,2,1] = 3
    alphas[8,2,2] = 3
    alphas[8,2,3] = 2
    alphas[8,2,4] = 0
    alphas[8,2,5] = 2
    alphas[8,2,6] = 1
    alphas[8,2,7] = 1
    alphas[8,2,8] = 0
    alphas[8,2,9] = 2
    alphas[8,3,0] = 2
    alphas[8,3,1] = 5
    alphas[8,3,2] = 0
    alphas[8,3,3] = 1
    alphas[8,3,4] = 5
    alphas[8,3,5] = 2
    alphas[8,3,6] = 2
    alphas[8,3,7] = 4
    alphas[8,3,8] = 2
    alphas[8,3,9] = 4
    alphas[9,0,0] = 3
    alphas[9,0,1] = 1
    alphas[9,0,2] = 4
    alphas[9,0,3] = 1
    alphas[9,0,4] = 4
    alphas[9,0,5] = 1
    alphas[9,0,6] = 5
    alphas[9,0,7] = 5
    alphas[9,0,8] = 0
    alphas[9,0,9] = 4
    alphas[9,1,0] = 2
    alphas[9,1,1] = 4
    alphas[9,1,2] = 1
    alphas[9,1,3] = 2
    alphas[9,1,4] = 3
    alphas[9,1,5] = 2
    alphas[9,1,6] = 5
    alphas[9,1,7] = 2
    alphas[9,1,8] = 1
    alphas[9,1,9] = 2
    alphas[9,2,0] = 2
    alphas[9,2,1] = 5
    alphas[9,2,2] = 3
    alphas[9,2,3] = 5
    alphas[9,2,4] = 4
    alphas[9,2,5] = 1
    alphas[9,2,6] = 5
    alphas[9,2,7] = 5
    alphas[9,2,8] = 1
    alphas[9,2,9] = 4
    alphas[9,3,0] = 4
    alphas[9,3,1] = 3
    alphas[9,3,2] = 4
    alphas[9,3,3] = 4
    alphas[9,3,4] = 0
    alphas[9,3,5] = 2
    alphas[9,3,6] = 2
    alphas[9,3,7] = 5
    alphas[9,3,8] = 3
    alphas[9,3,9] = 3

    # The decay coefficients $\beta$
    betas = np.zeros((n_events, n_states, n_events))
    # betas[0, 0, 0] = 4
    # betas[0, 0, 1] = 12
    # betas[1, 0, 0] = 14
    # betas[1, 0, 1] = 10
    # betas[0, 1, 0] = 14
    # betas[0, 1, 1] = 15
    # betas[1, 1, 0] = 10
    # betas[1, 1, 1] = 14

    betas[0,0,0] = 12
    betas[0,0,1] = 16
    betas[0,0,2] = 11
    betas[0,0,3] = 11
    betas[0,0,4] = 10
    betas[0,0,5] = 12
    betas[0,0,6] = 14
    betas[0,0,7] = 10
    betas[0,0,8] = 15
    betas[0,0,9] = 13
    betas[0,1,0] = 17
    betas[0,1,1] = 18
    betas[0,1,2] = 15
    betas[0,1,3] = 20
    betas[0,1,4] = 13
    betas[0,1,5] = 11
    betas[0,1,6] = 16
    betas[0,1,7] = 18
    betas[0,1,8] = 20
    betas[0,1,9] = 14
    betas[0,2,0] = 19
    betas[0,2,1] = 12
    betas[0,2,2] = 19
    betas[0,2,3] = 20
    betas[0,2,4] = 18
    betas[0,2,5] = 13
    betas[0,2,6] = 11
    betas[0,2,7] = 16
    betas[0,2,8] = 18
    betas[0,2,9] = 19
    betas[0,3,0] = 19
    betas[0,3,1] = 18
    betas[0,3,2] = 10
    betas[0,3,3] = 16
    betas[0,3,4] = 14
    betas[0,3,5] = 18
    betas[0,3,6] = 15
    betas[0,3,7] = 11
    betas[0,3,8] = 11
    betas[0,3,9] = 19
    betas[1,0,0] = 10
    betas[1,0,1] = 11
    betas[1,0,2] = 19
    betas[1,0,3] = 10
    betas[1,0,4] = 10
    betas[1,0,5] = 18
    betas[1,0,6] = 12
    betas[1,0,7] = 12
    betas[1,0,8] = 16
    betas[1,0,9] = 10
    betas[1,1,0] = 12
    betas[1,1,1] = 12
    betas[1,1,2] = 20
    betas[1,1,3] = 16
    betas[1,1,4] = 20
    betas[1,1,5] = 16
    betas[1,1,6] = 18
    betas[1,1,7] = 19
    betas[1,1,8] = 15
    betas[1,1,9] = 12
    betas[1,2,0] = 12
    betas[1,2,1] = 10
    betas[1,2,2] = 13
    betas[1,2,3] = 19
    betas[1,2,4] = 13
    betas[1,2,5] = 15
    betas[1,2,6] = 13
    betas[1,2,7] = 15
    betas[1,2,8] = 19
    betas[1,2,9] = 14
    betas[1,3,0] = 17
    betas[1,3,1] = 18
    betas[1,3,2] = 14
    betas[1,3,3] = 15
    betas[1,3,4] = 17
    betas[1,3,5] = 19
    betas[1,3,6] = 20
    betas[1,3,7] = 14
    betas[1,3,8] = 13
    betas[1,3,9] = 16
    betas[2,0,0] = 10
    betas[2,0,1] = 10
    betas[2,0,2] = 19
    betas[2,0,3] = 12
    betas[2,0,4] = 16
    betas[2,0,5] = 12
    betas[2,0,6] = 10
    betas[2,0,7] = 14
    betas[2,0,8] = 20
    betas[2,0,9] = 13
    betas[2,1,0] = 11
    betas[2,1,1] = 16
    betas[2,1,2] = 17
    betas[2,1,3] = 10
    betas[2,1,4] = 17
    betas[2,1,5] = 13
    betas[2,1,6] = 10
    betas[2,1,7] = 11
    betas[2,1,8] = 18
    betas[2,1,9] = 19
    betas[2,2,0] = 11
    betas[2,2,1] = 17
    betas[2,2,2] = 11
    betas[2,2,3] = 18
    betas[2,2,4] = 14
    betas[2,2,5] = 19
    betas[2,2,6] = 18
    betas[2,2,7] = 14
    betas[2,2,8] = 19
    betas[2,2,9] = 13
    betas[2,3,0] = 15
    betas[2,3,1] = 13
    betas[2,3,2] = 15
    betas[2,3,3] = 11
    betas[2,3,4] = 13
    betas[2,3,5] = 11
    betas[2,3,6] = 10
    betas[2,3,7] = 18
    betas[2,3,8] = 19
    betas[2,3,9] = 16
    betas[3,0,0] = 17
    betas[3,0,1] = 14
    betas[3,0,2] = 18
    betas[3,0,3] = 15
    betas[3,0,4] = 16
    betas[3,0,5] = 15
    betas[3,0,6] = 15
    betas[3,0,7] = 14
    betas[3,0,8] = 13
    betas[3,0,9] = 13
    betas[3,1,0] = 17
    betas[3,1,1] = 13
    betas[3,1,2] = 12
    betas[3,1,3] = 16
    betas[3,1,4] = 11
    betas[3,1,5] = 14
    betas[3,1,6] = 10
    betas[3,1,7] = 17
    betas[3,1,8] = 14
    betas[3,1,9] = 15
    betas[3,2,0] = 18
    betas[3,2,1] = 14
    betas[3,2,2] = 18
    betas[3,2,3] = 10
    betas[3,2,4] = 16
    betas[3,2,5] = 20
    betas[3,2,6] = 16
    betas[3,2,7] = 15
    betas[3,2,8] = 17
    betas[3,2,9] = 13
    betas[3,3,0] = 11
    betas[3,3,1] = 14
    betas[3,3,2] = 11
    betas[3,3,3] = 13
    betas[3,3,4] = 20
    betas[3,3,5] = 18
    betas[3,3,6] = 12
    betas[3,3,7] = 15
    betas[3,3,8] = 16
    betas[3,3,9] = 10
    betas[4,0,0] = 11
    betas[4,0,1] = 10
    betas[4,0,2] = 16
    betas[4,0,3] = 10
    betas[4,0,4] = 11
    betas[4,0,5] = 14
    betas[4,0,6] = 18
    betas[4,0,7] = 18
    betas[4,0,8] = 16
    betas[4,0,9] = 15
    betas[4,1,0] = 17
    betas[4,1,1] = 16
    betas[4,1,2] = 12
    betas[4,1,3] = 14
    betas[4,1,4] = 17
    betas[4,1,5] = 11
    betas[4,1,6] = 16
    betas[4,1,7] = 19
    betas[4,1,8] = 12
    betas[4,1,9] = 15
    betas[4,2,0] = 15
    betas[4,2,1] = 17
    betas[4,2,2] = 14
    betas[4,2,3] = 18
    betas[4,2,4] = 11
    betas[4,2,5] = 12
    betas[4,2,6] = 17
    betas[4,2,7] = 10
    betas[4,2,8] = 14
    betas[4,2,9] = 14
    betas[4,3,0] = 18
    betas[4,3,1] = 13
    betas[4,3,2] = 17
    betas[4,3,3] = 10
    betas[4,3,4] = 12
    betas[4,3,5] = 10
    betas[4,3,6] = 15
    betas[4,3,7] = 10
    betas[4,3,8] = 20
    betas[4,3,9] = 15
    betas[5,0,0] = 18
    betas[5,0,1] = 16
    betas[5,0,2] = 10
    betas[5,0,3] = 20
    betas[5,0,4] = 15
    betas[5,0,5] = 11
    betas[5,0,6] = 12
    betas[5,0,7] = 13
    betas[5,0,8] = 18
    betas[5,0,9] = 15
    betas[5,1,0] = 12
    betas[5,1,1] = 15
    betas[5,1,2] = 20
    betas[5,1,3] = 18
    betas[5,1,4] = 18
    betas[5,1,5] = 18
    betas[5,1,6] = 19
    betas[5,1,7] = 18
    betas[5,1,8] = 14
    betas[5,1,9] = 14
    betas[5,2,0] = 16
    betas[5,2,1] = 15
    betas[5,2,2] = 19
    betas[5,2,3] = 15
    betas[5,2,4] = 16
    betas[5,2,5] = 17
    betas[5,2,6] = 18
    betas[5,2,7] = 20
    betas[5,2,8] = 10
    betas[5,2,9] = 13
    betas[5,3,0] = 12
    betas[5,3,1] = 13
    betas[5,3,2] = 11
    betas[5,3,3] = 16
    betas[5,3,4] = 17
    betas[5,3,5] = 14
    betas[5,3,6] = 11
    betas[5,3,7] = 19
    betas[5,3,8] = 12
    betas[5,3,9] = 12
    betas[6,0,0] = 14
    betas[6,0,1] = 16
    betas[6,0,2] = 18
    betas[6,0,3] = 10
    betas[6,0,4] = 10
    betas[6,0,5] = 14
    betas[6,0,6] = 10
    betas[6,0,7] = 15
    betas[6,0,8] = 11
    betas[6,0,9] = 10
    betas[6,1,0] = 14
    betas[6,1,1] = 20
    betas[6,1,2] = 18
    betas[6,1,3] = 13
    betas[6,1,4] = 11
    betas[6,1,5] = 14
    betas[6,1,6] = 19
    betas[6,1,7] = 16
    betas[6,1,8] = 13
    betas[6,1,9] = 17
    betas[6,2,0] = 17
    betas[6,2,1] = 11
    betas[6,2,2] = 15
    betas[6,2,3] = 18
    betas[6,2,4] = 10
    betas[6,2,5] = 19
    betas[6,2,6] = 16
    betas[6,2,7] = 18
    betas[6,2,8] = 16
    betas[6,2,9] = 14
    betas[6,3,0] = 16
    betas[6,3,1] = 11
    betas[6,3,2] = 11
    betas[6,3,3] = 12
    betas[6,3,4] = 16
    betas[6,3,5] = 17
    betas[6,3,6] = 18
    betas[6,3,7] = 16
    betas[6,3,8] = 17
    betas[6,3,9] = 13
    betas[7,0,0] = 15
    betas[7,0,1] = 20
    betas[7,0,2] = 14
    betas[7,0,3] = 19
    betas[7,0,4] = 20
    betas[7,0,5] = 20
    betas[7,0,6] = 17
    betas[7,0,7] = 12
    betas[7,0,8] = 13
    betas[7,0,9] = 19
    betas[7,1,0] = 12
    betas[7,1,1] = 20
    betas[7,1,2] = 11
    betas[7,1,3] = 12
    betas[7,1,4] = 20
    betas[7,1,5] = 11
    betas[7,1,6] = 15
    betas[7,1,7] = 11
    betas[7,1,8] = 17
    betas[7,1,9] = 15
    betas[7,2,0] = 16
    betas[7,2,1] = 10
    betas[7,2,2] = 18
    betas[7,2,3] = 12
    betas[7,2,4] = 18
    betas[7,2,5] = 10
    betas[7,2,6] = 17
    betas[7,2,7] = 15
    betas[7,2,8] = 15
    betas[7,2,9] = 16
    betas[7,3,0] = 11
    betas[7,3,1] = 11
    betas[7,3,2] = 11
    betas[7,3,3] = 11
    betas[7,3,4] = 10
    betas[7,3,5] = 12
    betas[7,3,6] = 18
    betas[7,3,7] = 20
    betas[7,3,8] = 13
    betas[7,3,9] = 15
    betas[8,0,0] = 17
    betas[8,0,1] = 11
    betas[8,0,2] = 19
    betas[8,0,3] = 13
    betas[8,0,4] = 12
    betas[8,0,5] = 14
    betas[8,0,6] = 18
    betas[8,0,7] = 14
    betas[8,0,8] = 15
    betas[8,0,9] = 10
    betas[8,1,0] = 10
    betas[8,1,1] = 12
    betas[8,1,2] = 11
    betas[8,1,3] = 19
    betas[8,1,4] = 12
    betas[8,1,5] = 15
    betas[8,1,6] = 18
    betas[8,1,7] = 19
    betas[8,1,8] = 19
    betas[8,1,9] = 20
    betas[8,2,0] = 11
    betas[8,2,1] = 13
    betas[8,2,2] = 20
    betas[8,2,3] = 12
    betas[8,2,4] = 17
    betas[8,2,5] = 10
    betas[8,2,6] = 18
    betas[8,2,7] = 20
    betas[8,2,8] = 17
    betas[8,2,9] = 13
    betas[8,3,0] = 17
    betas[8,3,1] = 12
    betas[8,3,2] = 19
    betas[8,3,3] = 14
    betas[8,3,4] = 10
    betas[8,3,5] = 10
    betas[8,3,6] = 13
    betas[8,3,7] = 12
    betas[8,3,8] = 13
    betas[8,3,9] = 13
    betas[9,0,0] = 12
    betas[9,0,1] = 19
    betas[9,0,2] = 18
    betas[9,0,3] = 10
    betas[9,0,4] = 11
    betas[9,0,5] = 12
    betas[9,0,6] = 20
    betas[9,0,7] = 12
    betas[9,0,8] = 14
    betas[9,0,9] = 15
    betas[9,1,0] = 19
    betas[9,1,1] = 20
    betas[9,1,2] = 17
    betas[9,1,3] = 17
    betas[9,1,4] = 18
    betas[9,1,5] = 16
    betas[9,1,6] = 11
    betas[9,1,7] = 18
    betas[9,1,8] = 19
    betas[9,1,9] = 10
    betas[9,2,0] = 16
    betas[9,2,1] = 12
    betas[9,2,2] = 12
    betas[9,2,3] = 15
    betas[9,2,4] = 18
    betas[9,2,5] = 17
    betas[9,2,6] = 19
    betas[9,2,7] = 20
    betas[9,2,8] = 13
    betas[9,2,9] = 15
    betas[9,3,0] = 14
    betas[9,3,1] = 20
    betas[9,3,2] = 12
    betas[9,3,3] = 12
    betas[9,3,4] = 15
    betas[9,3,5] = 18
    betas[9,3,6] = 20
    betas[9,3,7] = 18
    betas[9,3,8] = 14
    betas[9,3,9] = 13

    #Instatiante the market
    marketSimulator = MarketSimulator(phis, nus, alphas, betas, n_events, n_states, events_labels, states_labels)
    ctxClient = CTXPyClient(r"home/henrique/CoinTossX/ClientSimulator/build/install/ClientSimulator/lib/")
    #ctxClient.Shutdown()
    
    curr_time  = 0 
    curr_state = 1
    stop_time  = 480

    print("[Client] Simulation class initialized. Starting loop. Sending first order")

    # ctxClient.SendAgressiveBid()
    #ctxClient.SendAggressiveCancelationBid()
    #ctxClient.SendAggressiveCancelationAsk()
    ctxClient.SendAgressiveBid()

    #print(ctxClient.GetLOB())

    lastEvent = 0

    while curr_time < stop_time:

        dict = marketSimulator.GetNextEvent(curr_state)

        print(curr_time)
        print(dict['event_type'])

        #Get next event from market simulation
        #marketSimulator.DumpSimulationResult()

        #Send event to market
        if (dict['event_type'] == 0): # MarketOrderAskStr):
            ctxClient.SendMarketAsk()
        elif (dict['event_type'] == 1): #MarketOrderBidStr):
            ctxClient.SendMarketBid()
        elif (dict['event_type'] == 2): #AggressiveLimitBidStr):
            ctxClient.SendAgressiveBid()
        elif (dict['event_type'] == 3): #AggressiveLimitAskStr):
            ctxClient.SendAgressiveAsk()
        elif (dict['event_type'] == 4): #PassiveLimitBidStr):
            ctxClient.SendPassiveBid()
        elif (dict['event_type'] == 5): #PassiveLimitAskStr):
            ctxClient.SendPassiveAsk()
        elif (dict['event_type'] == 6): #AggressiveCancelBidStr):
            ctxClient.SendAggressiveCancelationBid()            
        elif (dict['event_type'] == 7): #AggressiveCancelAskStr):
            ctxClient.SendAggressiveCancelationAsk()
        elif (dict['event_type'] == 8): #PassiveCancelBidStr):
            ctxClient.SendPassiveCancelationBid
        elif (dict['event_type'] == 9): #PassiveCancelAskStr):
            ctxClient.SendPassiveCancelationAsk()

        #book = ctxClient.GetLOB()
            
        #Get new state
        imbalance = ctxClient.GetImbalance()
        spread = ctxClient.GetSpread()
        #print(ctxClient.GetLOB())
        curr_state = ParseState(spread, imbalance)

        #Update curr_time
        curr_time += dict["event_time"]

        lastEvent = dict['event_type']

        #sleep(0.1)
        

    marketSimulator.DumpSimulationResult()
    marketSimulator.SaveResults()

    ctxClient.Shutdown()
        
